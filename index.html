
<html>
<head>
    <title>è”åˆå›½æŒ–æ˜æœºçš„ä¸ªäººæ—¥å¿—</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <style>
        body {
            background: #E7F3FF url("https://www.transparenttextures.com/patterns/diamond-upholstery.png");
            font-family: SimSun, å®‹ä½“;
            font-size: 12px;
            margin: 0;
            line-height: 1.5;
        }

        a {
            color: #0000CC;
            text-decoration: none;
            cursor: pointer;
        }

        a:hover {
            color: #FF0000;
            text-decoration: underline;
        }

        .box {
            border: 1px solid #B4D3F5;
            background: #FFFFFF;
            margin-bottom: 10px;
        }

        .title {
            background: #E7F1FF;
            padding: 8px;
            font-weight: bold;
            border-bottom: 1px solid #B4D3F5;
            color: #0055AA;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .title .btn-link {
            font-size: 11px;
            font-weight: normal;
            background: #F0F0F0;
            padding: 2px 6px;
            border: 1px solid #B4D3F5;
            color: #0055AA;
        }
        .title .btn-link:hover {
            background: #FFE4E1;
            color: #F45A8D;
            text-decoration: none;
        }

        .post {
            padding: 15px;
            border-bottom: 1px dashed #CCC;
        }

        .post-title {
            font-size: 16px;
            font-weight: bold;
            color: #F45A8D;
            margin-bottom: 5px;
        }

        .post-date {
            font-size: 11px;
            color: #888;
            margin-bottom: 10px;
            background: #F0F0F0;
            padding: 2px 5px;
            display: inline-block;
        }

        .post-content {
            color: #333;
            font-size: 13px;
            white-space: pre-wrap;
        }

        .read-more {
            color: #FF6600;
            font-weight: bold;
            display: inline-block;
            margin-top: 8px;
        }

        .back-link {
            color: #0055AA;
            margin-bottom: 10px;
            display: inline-block;
            font-weight: bold;
        }

        .footer {
            background: #F0F0F0;
            padding: 15px;
            text-align: center;
            border-top: 1px solid #CCC;
        }

        .loading {
            padding: 20px;
            text-align: center;
            color: #888;
        }

        .error {
            padding: 20px;
            text-align: center;
            color: #F45A8D;
        }

        ul {
            padding-left: 25px;
        }

        ul li {
            margin: 5px 0;
        }
    </style>
</head>
<body>

<embed src="https://files.catbox.moe/2q1k9m.mid" autostart="true" loop="true" hidden="true">

<table width="800" align="center" cellpadding="0" cellspacing="0" class="box">
    <tr>
        <td>
            <table width="100%" bgcolor="#00A1D6" cellpadding="10">
                <tr>
                    <td>
                        <font size="6" color="red">è”</font>
                        <font size="6" color="orange">åˆ</font>
                        <font size="6" color="yellow">å›½</font>
                        <font size="6" color="green">æŒ–</font>
                        <font size="6" color="blue">æ˜</font>
                        <font size="6" color="purple">æœº</font>
                        <font size="2" color="#FFFFFF">éšæ„çš„ç½‘é¡µ</font>
                    </td>
                    <td align="right">
                        <font color="#FFFFFF"><span id="time"></span></font>
                    </td>
                </tr>
            </table>

            <div style="background:#FFF8DC; border-top:3px solid #F45A8D; padding:3px;">
                <marquee scrollamount="3">â˜… æ¬¢è¿æ¥åˆ°æˆ‘çš„ä¸ªäººåšå®¢ â˜… æ‰€æœ‰æ–‡ç« æ¥è‡ªposts.txt â˜… æ‰€æœ‰äººçœ‹åˆ°ç›¸åŒå†…å®¹ â˜…</marquee>
            </div>

            <div style="background:#F8F8F8; padding:5px; border-bottom:1px solid #CCC;">
                [<a href="#" onclick="renderPosts('latest'); return false;">æ—¥å¿—é¦–é¡µ</a>]
                [<a href="#">ç›¸å†Œ</a>]
                [<a href="#">ç•™è¨€æ¿</a>]
                [<a href="#">ä¸ªäººæ¡£æ¡ˆ</a>]
                [<a href="#"><font color="red">RSSè®¢é˜…</font></a>]
            </div>

            <table width="100%" cellpadding="10" cellspacing="0">
                <tr>
                    <td width="550" valign="top">
                        <div class="box">
                            <div class="title" id="view-title">
                                <span>æœ€æ–°æ—¥å¿— (Recent Posts)</span>
                                <a href="#" class="btn-link" id="viewAllBtn" onclick="renderPosts('all'); return false;">[ å…¨éƒ¨æ–‡ç«  ]</a>
                            </div>

                            <!-- æ–‡ç« å®¹å™¨åŠ¨æ€ç”Ÿæˆ -->
                            <div id="posts-container">
                                <div class="loading">æ­£åœ¨åŠ è½½æ–‡ç« ...</div>
                            </div>
                        </div>
                    </td>

                    <td width="230" valign="top">
                        <div class="box">
                            <div class="title">åšä¸»ç®€ä»‹</div>
                            <div style="padding:10px; text-align:center;">
                                <img src="avt.png" width="120" height="120"
                                     style="border:1px solid #CCC; padding:2px;"
                                     onerror="this.src='data:image/svg+xml;utf8,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%22120%22 height=%22120%22><rect width=%22120%22 height=%22120%22 fill=%22%23E7F1FF%22/><text x=%2210%22 y=%2260%22 fill=%22%230055AA%22>æŒ–æ˜æœº</text></svg>'"><br>
                                <b>è”åˆå›½æŒ–æ˜æœº</b><br>
                                ç°å±…ï¼šå¹»æƒ³ä¹¡<br>
                                çˆ±å¥½ï¼šæ¬è¿è§†é¢‘ã€æ”¹ä»£ç <br>
<!--                                //<small><a href="#" onclick="showEditGuide()" style="color:#F45A8D;">[å¦‚ä½•å‘å¸ƒæ–‡ç« ]</a></small>-->
                            </div>
                        </div>

                        <div class="box">
                            <div class="title">æ—¥å¿—åˆ†ç±»</div>
                            <ul id="category-list">
                                <li>åŠ è½½ä¸­...</li>
                            </ul>
                        </div>

                        <div class="box">
                            <div class="title">å‹æƒ…é“¾æ¥</div>
                            <div style="padding:10px;">
                                <a href="#">ACFUN.CN</a><br>
                                <a href="#">Mikufans.cn</a><br>
                                <a href="#">ç™¾åº¦è´´å§</a><br>
                                <a href="#">å¤©ç©ºè½¯ä»¶å›­</a><br>
                                <a href="#">åå†›è½¯ä»¶å›­</a><br>
                                <a href="#">èŒå¨˜ç™¾ç§‘</a>
                            </div>
                        </div>
                    </td>
                </tr>
            </table>

            <div class="footer">
                æ‚¨æ˜¯æœ¬ç«™ç¬¬ <span id="counter" style="color:red; font-weight:bold;">000000</span> ä½è®¿å®¢<br>
                Copyright Â© 2009-2024 è”åˆå›½æŒ–æ˜æœº Blog<br>
                <img src="gif.gif" width="38" height="33" onerror="this.style.display='none'">
            </div>
        </td>
    </tr>
</table>

<script>
    // ==================== å…¨å±€å˜é‡ ====================
    let allPosts = [];           // å­˜å‚¨æ‰€æœ‰æ–‡ç« 
    let currentMode = 'latest';  // å½“å‰æ˜¾ç¤ºæ¨¡å¼
    let categories = new Set();  // æ‰€æœ‰åˆ†ç±»

    // ==================== ä»TXTåŠ è½½æ–‡ç«  ====================
    async function loadPostsFromTXT() {
        try {
            const response = await fetch('posts.txt?' + new Date().getTime()); // åŠ æ—¶é—´æˆ³é˜²æ­¢ç¼“å­˜
            if (!response.ok) {
                throw new Error('æ— æ³•åŠ è½½posts.txtæ–‡ä»¶');
            }
            const text = await response.text();

            // è§£ææ–‡ç« 
            const posts = [];
            const articles = text.split('===æ–‡ç« å¼€å§‹===');

            for (let article of articles) {
                if (!article.includes('===æ–‡ç« ç»“æŸ===')) continue;

                // æå–æ–‡ç« å†…å®¹éƒ¨åˆ†
                const content = article.split('===æ–‡ç« ç»“æŸ===')[0].trim();
                const post = {};

                // è§£ææ¯ä¸€è¡Œ
                content.split('\n').forEach(line => {
                    line = line.trim();
                    if (line.startsWith('id=')) post.id = line.substring(3).trim();
                    if (line.startsWith('æ ‡é¢˜=')) post.title = line.substring(3).trim();
                    if (line.startsWith('æ—¥æœŸ=')) post.date = line.substring(3).trim();
                    if (line.startsWith('åˆ†ç±»=')) post.category = line.substring(3).trim();
                    if (line.startsWith('å†…å®¹=')) post.content = line.substring(3).trim();
                });

                // ç¡®ä¿å¿…è¦çš„å­—æ®µå­˜åœ¨
                if (post.id && post.title && post.date && post.category && post.content) {
                    // è½¬æ¢idä¸ºæ•°å­—
                    post.id = parseInt(post.id);
                    posts.push(post);

                    // æ”¶é›†åˆ†ç±»
                    if (post.category) {
                        categories.add(post.category);
                    }
                }
            }

            // æŒ‰æ—¥æœŸæ’åºï¼ˆæœ€æ–°çš„åœ¨å‰ï¼‰
            posts.sort((a, b) => new Date(b.date) - new Date(a.date));

            return posts;
        } catch (error) {
            console.error('åŠ è½½æ–‡ç« å¤±è´¥:', error);
            // è¿”å›é»˜è®¤æ–‡ç« 
            return getDefaultPosts();
        }
    }

    // ==================== é»˜è®¤æ–‡ç« ï¼ˆå½“TXTæ–‡ä»¶ä¸å­˜åœ¨æ—¶ï¼‰ ====================
    function getDefaultPosts() {
        return [
            {
                id: 1,
                title: "ã€å¿ƒæƒ…ã€‘ä»Šå¤©ç»ˆäºæå®šäº†CSSå¸ƒå±€",
                date: "2009-10-24 22:30",
                category: "æŠ€æœ¯æŠ˜è…¾",
                content: "æŠ˜è…¾äº†åŠå¤©IE6çš„åŒå€è¾¹è·BUGï¼Œç»ˆäºè®©é¡µé¢çœ‹èµ·æ¥æ­£å¸¸äº†ã€‚æœç„¶ç”¨Tableå¸ƒå±€è¿˜æ˜¯æœ€ç¨³çš„â€¦â€¦"
            },
            {
                id: 2,
                title: "ã€ŠæŸç§‘å­¦çš„è¶…ç”µç£ç‚®ã€‹ç¬¬ä¸€è¯è§‚åæ„Ÿ",
                date: "2009-10-23 15:10",
                category: "äºŒæ¬¡å…ƒ",
                content: "ç‚®å§å¤ªå¸…äº†ï¼Only my railgun å‰å¥ä¸€å“æ•´ä¸ªäººéƒ½ç‡ƒèµ·æ¥äº†ã€‚å¸Œæœ›Bç«™èƒ½å¿«ç‚¹å‡ºç†Ÿè‚‰ã€‚"
            }
        ];
    }

    // ==================== åˆå§‹åŒ–åšå®¢ ====================
    async function initBlog() {
        const container = document.getElementById('posts-container');
        container.innerHTML = '<div class="loading">æ­£åœ¨åŠ è½½æ–‡ç« ...</div>';

        // åŠ è½½æ–‡ç« 
        allPosts = await loadPostsFromTXT();

        // æ›´æ–°åˆ†ç±»åˆ—è¡¨
        updateCategoryList();

        // æ¸²æŸ“æœ€æ–°æ–‡ç« 
        renderPosts('latest');
    }

    // ==================== æ›´æ–°åˆ†ç±»åˆ—è¡¨ ====================
    function updateCategoryList() {
        const categoryList = document.getElementById('category-list');
        if (!categoryList) return;

        if (categories.size === 0) {
            categoryList.innerHTML = '<li>æš‚æ— åˆ†ç±»</li>';
            return;
        }

        let html = '';
        Array.from(categories).sort().forEach(cat => {
            // ç»Ÿè®¡è¯¥åˆ†ç±»çš„æ–‡ç« æ•°é‡
            const count = allPosts.filter(p => p.category === cat).length;
            html += `<li><a href="#" onclick="filterByCategory('${cat}'); return false;">${cat} (${count})</a></li>`;
        });
        html += `<li><a href="#" onclick="renderPosts('all'); return false;">[æŸ¥çœ‹å…¨éƒ¨]</a></li>`;

        categoryList.innerHTML = html;
    }

    // ==================== æ¸²æŸ“å‡½æ•° ====================
    function renderPosts(mode, param = null) {
        currentMode = mode;

        if (mode === 'latest') {
            displayLatest();
        } else if (mode === 'all') {
            displayAll();
        } else if (mode === 'single') {
            displaySingle(param);
        } else if (mode === 'category') {
            displayCategory(param);
        }

        // æ›´æ–°å…¨éƒ¨æŒ‰é’®æ–‡å­—
        updateViewAllButton(mode);
    }

    function displayLatest() {
        const container = document.getElementById('posts-container');
        const titleSpan = document.getElementById('view-title').querySelector('span');
        titleSpan.innerText = 'æœ€æ–°æ—¥å¿— (Recent Posts)';

        // æ˜¾ç¤ºæœ€æ–°çš„3ç¯‡
        const latestPosts = allPosts.slice(0, 3);
        renderPostList(latestPosts, false);
    }

    function displayAll() {
        const titleSpan = document.getElementById('view-title').querySelector('span');
        titleSpan.innerText = 'å…¨éƒ¨æ—¥å¿— (All Posts)';
        renderPostList(allPosts, false);
    }

    function displaySingle(postId) {
        const post = allPosts.find(p => p.id == postId);
        if (!post) {
            displayLatest();
            return;
        }

        const container = document.getElementById('posts-container');
        const titleSpan = document.getElementById('view-title').querySelector('span');
        titleSpan.innerText = 'æ­£æ–‡é˜…è¯»';

        // åˆ›å»ºè¿”å›é“¾æ¥
        const backLink = document.createElement('a');
        backLink.href = '#';
        backLink.className = 'back-link';
        backLink.innerText = '<< è¿”å›é¦–é¡µ';
        backLink.onclick = (e) => { e.preventDefault(); renderPosts('latest'); };

        container.innerHTML = '';
        container.appendChild(backLink);
        container.appendChild(createPostElement(post, true));
    }

    function displayCategory(category) {
        const filtered = allPosts.filter(p => p.category === category);
        const titleSpan = document.getElementById('view-title').querySelector('span');
        titleSpan.innerText = `åˆ†ç±»ï¼š${category} (${filtered.length}ç¯‡)`;
        renderPostList(filtered, false);
    }

    // ==================== æ¸²æŸ“æ–‡ç« åˆ—è¡¨ ====================
    function renderPostList(posts, isFull = false) {
        const container = document.getElementById('posts-container');
        container.innerHTML = '';

        if (posts.length === 0) {
            container.innerHTML = '<div class="post">æš‚æ— æ–‡ç« </div>';
            return;
        }

        posts.forEach(post => {
            container.appendChild(createPostElement(post, false));
        });
    }

    // ==================== åˆ›å»ºå•ç¯‡æ–‡ç« DOM ====================
    function createPostElement(post, isFull) {
        const div = document.createElement('div');
        div.className = 'post';

        // æ ‡é¢˜
        const titleDiv = document.createElement('div');
        titleDiv.className = 'post-title';
        titleDiv.innerText = post.title;
        div.appendChild(titleDiv);

        // æ—¥æœŸå’Œåˆ†ç±»
        const dateDiv = document.createElement('div');
        dateDiv.className = 'post-date';
        dateDiv.innerText = `å‘è¡¨äºï¼š${post.date} | åˆ†ç±»ï¼š${post.category}`;
        div.appendChild(dateDiv);

        // å†…å®¹
        const contentDiv = document.createElement('div');
        contentDiv.className = 'post-content';
        if (isFull) {
            contentDiv.innerText = post.content;
        } else {
            let brief = post.content.length > 60 ? post.content.substring(0, 60) + 'â€¦â€¦' : post.content;
            contentDiv.innerText = brief;
        }
        div.appendChild(contentDiv);

        // é˜…è¯»å…¨æ–‡é“¾æ¥ï¼ˆåªåœ¨åˆ—è¡¨æ¨¡å¼æ˜¾ç¤ºï¼‰
        if (!isFull) {
            const moreLink = document.createElement('a');
            moreLink.href = '#';
            moreLink.className = 'read-more';
            moreLink.innerText = '[é˜…è¯»å…¨æ–‡]';
            moreLink.onclick = (e) => {
                e.preventDefault();
                renderPosts('single', post.id);
            };
            div.appendChild(document.createElement('br'));
            div.appendChild(moreLink);
        }

        return div;
    }

    // ==================== æ›´æ–°å…¨éƒ¨æŒ‰é’® ====================
    function updateViewAllButton(mode) {
        const btn = document.getElementById('viewAllBtn');
        if (!btn) return;

        if (mode === 'all') {
            btn.innerHTML = '[ æœ€æ–°æ–‡ç«  ]';
            btn.onclick = function(e) { e.preventDefault(); renderPosts('latest'); };
        } else {
            btn.innerHTML = '[ å…¨éƒ¨æ–‡ç«  ]';
            btn.onclick = function(e) { e.preventDefault(); renderPosts('all'); };
        }
    }

    // ==================== åˆ†ç±»ç­›é€‰ ====================
    function filterByCategory(category) {
        renderPosts('category', category);
    }

    // ==================== å‘å¸ƒæŒ‡å— ====================
//     function showEditGuide() {
//         const container = document.getElementById('posts-container');
//         const titleSpan = document.getElementById('view-title').querySelector('span');
//         titleSpan.innerText = 'å¦‚ä½•å‘å¸ƒæ–‡ç« ';
//
//         container.innerHTML = `
//             <div class="post">
//                 <div class="post-title">ğŸ“ å‘å¸ƒæ–°æ–‡ç« çš„æ–¹æ³•</div>
//                 <div class="post-content">
//                     <p><b>æ–¹æ³•1ï¼šåœ¨GitHubç½‘é¡µç‰ˆç¼–è¾‘</b><br>
//                     1. æ‰“å¼€ä½ çš„GitHubä»“åº“<br>
//                     2. æ‰¾åˆ° <code>posts.txt</code> æ–‡ä»¶<br>
//                     3. ç‚¹å‡»é“…ç¬”å›¾æ ‡ç¼–è¾‘<br>
//                     4. æŒ‰ç…§ä¸‹é¢çš„æ ¼å¼æ·»åŠ æ–°æ–‡ç« <br>
//                     5. ç‚¹å‡»"Commit changes"</p>
//
//                     <p><b>ğŸ“„ æ–‡ç« æ ¼å¼ï¼ˆå¤åˆ¶ç²˜è´´ï¼‰ï¼š</b></p>
//                     <pre style="background:#F0F0F0; padding:10px; border:1px solid #CCC;">
// ===æ–‡ç« å¼€å§‹===
// id=3
// æ ‡é¢˜=ä½ çš„æ–‡ç« æ ‡é¢˜
// æ—¥æœŸ=2024-01-20 15:30
// åˆ†ç±»=ç”Ÿæ´»çäº‹
// å†…å®¹=è¿™é‡Œæ˜¯æ–‡ç« å†…å®¹ï¼Œå¯ä»¥å†™å¾ˆå¤šè¡Œâ€¦â€¦
// ===æ–‡ç« ç»“æŸ===</pre>
//
//                     <p><b>âš ï¸ æ³¨æ„ï¼š</b><br>
//                     - idä¸èƒ½é‡å¤ï¼Œæœ€å¥½ç”¨å½“å‰æ—¶é—´æˆ³<br>
//                     - æ—¥æœŸæ ¼å¼ï¼šYYYY-MM-DD HH:MM<br>
//                     - ä¿å­˜åæ‰€æœ‰äººç«‹åˆ»çœ‹åˆ°æ–°æ–‡ç« </p>
//
//                     <p><a href="#" onclick="renderPosts('latest'); return false;">â† è¿”å›é¦–é¡µ</a></p>
//                 </div>
//             </div>
//         `;
//     }

    // ==================== æ—¶é—´å’Œè®¡æ•°å™¨ ====================
    function updateTime() {
        const now = new Date();
        const week = "æ—¥ä¸€äºŒä¸‰å››äº”å…­"[now.getDay()];
        document.getElementById("time").innerHTML = now.getFullYear() + "å¹´" +
            (now.getMonth() + 1) + "æœˆ" + now.getDate() + "æ—¥ æ˜ŸæœŸ" + week + "<br>" +
            now.toLocaleTimeString();
    }
    setInterval(updateTime, 1000);
    updateTime();

    // è®¿å®¢è®¡æ•°å™¨
    if (!localStorage.getItem("blogCounter")) {
        localStorage.setItem("blogCounter", "1024");
    }
    let count = parseInt(localStorage.getItem("blogCounter")) + 1;
    localStorage.setItem("blogCounter", count);
    document.getElementById("counter").innerText = count.toString().padStart(6, "0");

    // å¯åŠ¨åšå®¢
    initBlog();
</script>
</body>
</html>


